name: concurrency
run-name: concurrency

on:
  pull_request:

concurrency:
  group: ${{ github.workflow }}-${{ github.event.pull_request.number }}
  cancel-in-progress: true

permissions:
  id-token: write
  contents: read
  pull-requests: read

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: hmarr/debug-action@v3 
      - uses: actions/checkout@v4
      - name: "Find changed terraform configs"
        id: changed-tf
        uses: tj-actions/changed-files@v44
        with:
          files: |
            ./**

      - name: List all changed files
        env:
          ALL_CHANGED_FILES: ${{ steps.changed-tf.outputs.all_changed_files }}
        run: |
          for file in ${ALL_CHANGED_FILES}; do
            echo "$file was changed"
          done

      - name: "Find changed terraform configs"
        id: changed-test1
        uses: tj-actions/changed-files@v44
        with:
          dir_names: true

      - name: List all changed files
        env:
          ALL_CHANGED_FILES: ${{ steps.changed-test1.outputs.all_changed_files }}
        run: |
          for file in ${ALL_CHANGED_FILES}; do
            echo "$file was changed"
          done

      - name: "Find changed terraform configs"
        id: changed-test1-2
        uses: tj-actions/changed-files@v44
        with:
          dir_names: true
          dir_names_max_depth: 1
          dir_names_exclude_current_dir: true
          files: |
            !./.github/**
            !./test/**
          matrix: true

      - name: List all changed files
        env:
          ALL_CHANGED_FILES: ${{ steps.changed-test1-2.outputs.all_changed_files }}
        run: |
          for file in ${ALL_CHANGED_FILES}; do
            echo "$file was changed"
          done
      - uses: hmarr/debug-action@v3
      
      - uses: amannn/action-semantic-pull-request@v5
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

  test:
    runs-on: ubuntu-latest
    steps:
      - name: Set Environment Failed
        run: |
          for i in 1 2 3 4 5
          do
            echo "Mendax Current number is: $i"
          done
  test3:
      needs: test2
      runs-on: ubuntu-latest
      steps:
        - name: Set Environment Failed
          run: |
            for i in 1 2 3 4 5
            do
              echo "Mendax Current number is: $i"
            done
  test2:
    needs: test
    runs-on: ubuntu-latest
    steps:
      - name: Set Environment Failed
        run: |
          for i in 1 2 3 4 5
          do
            echo "Mendax Current number is: $i"
          done
  
